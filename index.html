<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chatbot Bellavista</title>

<style>
  body {
    font-family: Arial, sans-serif;
  }
  #chatbox {
    width: 350px;
    height: 520px;
    border: 1px solid #ccc;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #messages {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #eee;
    padding: 8px;
    background: #fafafa;
  }
  #inputArea {
    display: flex;
    gap: 6px;
  }
  input, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  button {
    padding: 8px 12px;
    background: #1e3a8a;
    color: white;
    border: none;
    cursor: pointer;
    width: 100%;
    margin-top: 6px;
    border-radius: 4px;
  }
</style>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function() {
  emailjs.init("_Iq2cEVId5yGaT-WvZMxE"); // TU PUBLIC KEY
})();
</script>

</head>
<body>

<div id="chatbox">
  <h3>Chat Municipalidad Bellavista</h3>

  <div id="messages"></div>

  <label>Nombre del vecino:</label>
  <input id="nombre" type="text">

  <label>Direcci√≥n del incidente:</label>
  <input id="direccion" type="text">

  <label>Detalle del problema:</label>
  <textarea id="detalle" rows="2"></textarea>

  <button onclick="enviarReporte()">Enviar reporte</button>
</div>

<script>
const messages = document.getElementById("messages");

function addMessage(text, sender = "bot") {
  const p = document.createElement("p");
  p.innerHTML = `<strong>${sender === "bot" ? "ü§ñ" : "üßë‚Äçüíº"}:</strong> ${text}`;
  messages.appendChild(p);
  messages.scrollTop = messages.scrollHeight;
}

// MENSAJE INICIAL
addMessage("Estimado vecino, contribuye a mantener una ciudad limpia. Por favor complete sus datos y env√≠e el reporte.");

function enviarReporte() {
  const nombre = document.getElementById("nombre").value.trim();
  const direccion = document.getElementById("direccion").value.trim();
  const detalle = document.getElementById("detalle").value.trim();

  if (!nombre || !direccion || !detalle) {
    addMessage("‚ö†Ô∏è Por favor complete todos los campos.", "bot");
    return;
  }

  addMessage("Enviando reporte...", "bot");

  const fecha = new Date().toLocaleString();

  emailjs.send(
    "service_6n1vp4m",
    "template_7yj72fo",
    {
      name: nombre,                        // ‚úî COINCIDE CON TU TEMPLATE
      time: fecha,                         // ‚úî COINCIDE CON TU TEMPLATE
      message: `Direcci√≥n: ${direccion}\nIncidencia: ${detalle}`  // ‚úî COINCIDE CON TU TEMPLATE
    }
  )
  .then(() => {
    addMessage("‚úîÔ∏è Tu reporte fue enviado correctamente. ¬°Gracias por colaborar!", "bot");
  })
  .catch((err) => {
    console.error(err);
    addMessage("‚ùå Hubo un error al enviar el reporte. Intente nuevamente.", "bot");
  });
}
</script>

</body>
</html>
