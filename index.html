<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitoreo Ciudadano - Bellavista</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fuente -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f3f4f6; 
        }
        #content-frame { height: calc(100vh - 120px); }
    </style>

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function() {
            emailjs.init("_Iq2cEVId5yGaT-WvZMxE");
        })();
    </script>
</head>

<body class="min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="bg-blue-900 shadow-lg p-4 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <img 
                    src="./logo-bellavista.jpeg" 
                    alt="Logo Bellavista"
                    class="h-12 w-12 rounded-full object-cover shadow-md"
                    onerror="this.src='https://placehold.co/60x60/1e3a8a/ffffff?text=LOGO'"
                >
                <h1 class="text-xl md:text-2xl font-bold text-white">
                    MONITOREO CIUDADANO DE CAMIONES COMPACTADORES
                </h1>
            </div>

            <span class="hidden sm:block bg-yellow-400 text-gray-900 text-sm font-semibold px-3 py-1 rounded-full shadow-inner">
                <span class="animate-pulse inline-block w-2 h-2 mr-1 bg-green-500 rounded-full"></span>
                En L√≠nea
            </span>
        </div>
    </header>

    <!-- CONTENIDO -->
    <main class="flex-grow p-4 md:p-6">
        <div class="max-w-full mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">

            <!-- MAPA / MONITOREO -->
            <iframe id="content-frame"
                src="https://monitoreo.gpseyes.pe/sharing/f26738032cc992ea790a7a6d80f5b066"
                class="w-full h-[80vh]"
                frameborder="0"
                allowfullscreen>
            </iframe>

        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-100 border-t border-gray-200 p-3 text-center text-sm text-gray-600">
        ¬© 2024 Monitoreo Ciudadano - Municipalidad Distrital de Bellavista.
    </footer>

    <!-- CHATBOT FLOTANTE -->
    <style>
        #chatbot-button {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: #1e3a8a;
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 9999;
        }

        #chatbot-window {
            width: 330px;
            height: 470px;
            background: #ffffff;
            position: fixed;
            bottom: 100px;
            right: 25px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.25);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 9999;
        }

        #chatbot-header {
            background: #1e3a8a;
            color: white;
            padding: 12px;
            font-weight: bold;
            text-align: center;
        }

        #chatbot-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background: #f8f8f8;
        }

        .msg {
            margin-bottom: 12px;
            padding: 10px 12px;
            max-width: 90%;
            border-radius: 12px;
            font-size: 14px;
        }

        .bot { background: #e5e7eb; color: #111827; }
        .user { background: #1e3a8a; color: white; margin-left: auto; }

        #chat-form {
            padding: 10px;
            background: #ffffff;
            border-top: 1px solid #ddd;
        }

        #chat-form input,
        #chat-form textarea {
            width: 100%;
            padding: 8px;
            margin-top: 6px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        #chat-form button {
            margin-top: 10px;
            width: 100%;
            background: #1e3a8a;
            color: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>

    <!-- BOT√ìN -->
    <div id="chatbot-button">üí¨</div>

    <!-- VENTANA DEL CHAT -->
    <div id="chatbot-window">
        <div id="chatbot-header">Asistente Virtual Bellavista</div>

        <div id="chatbot-messages"></div>

        <!-- FORMULARIO -->
        <div id="chat-form">
            <label>Nombre:</label>
            <input type="text" id="chat-nombre">

            <label>Direcci√≥n:</label>
            <input type="text" id="chat-direccion">

            <label>Detalle del problema:</label>
            <textarea id="chat-incidencia" rows="3"></textarea>

            <button onclick="enviarReporte()">Enviar reporte</button>
        </div>
    </div>

    <!-- SCRIPT DEL CHAT -->
    <script>
        const chatButton = document.getElementById("chatbot-button");
        const chatWindow = document.getElementById("chatbot-window");
        const messages = document.getElementById("chatbot-messages");

        chatButton.onclick = () => {
            chatWindow.style.display = chatWindow.style.display === "flex" ? "none" : "flex";
        };

        function addMessage(text, type = "bot") {
            const div = document.createElement("div");
            div.className = "msg " + type;
            div.innerHTML = text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        // Mensaje inicial
        addMessage("Estimado vecino, contribuye a mantener una ciudad limpia.<br>Complete los datos y env√≠e su reporte.");

        function enviarReporte() {
            const name = document.getElementById("chat-nombre").value.trim();
            const direccion = document.getElementById("chat-direccion").value.trim();
            const incidencia = document.getElementById("chat-incidencia").value.trim();

            if (!name || !direccion || !incidencia) {
                addMessage("‚ö†Ô∏è Por favor complete todos los campos.", "bot");
                return;
            }

            addMessage("Enviando reporte...", "bot");

            // ENV√çO EmailJS
            emailjs.send("service_6n1vp4m", "template_7yj72fo", {
                name: name,
                time: new Date().toLocaleString(),
                message: `Direcci√≥n: ${direccion}\nIncidencia: ${incidencia}`
            })
            .then(() => {
                addMessage("‚úîÔ∏è Reporte enviado correctamente.", "bot");
            })
            .catch(() => {
                addMessage("‚ùå Hubo un error al enviar el reporte.", "bot");
            });
        }
    </script>

</body>
</html>
